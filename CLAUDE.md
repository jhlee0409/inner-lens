# CLAUDE.md - inner-lens

> AI ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ìœ„í•œ í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸ ë¬¸ì„œ

## í”„ë¡œì íŠ¸ ê°œìš”

**inner-lens**: Self-Debugging QA Agent - ìœ ë‹ˆë²„ì„¤ ë²„ê·¸ ë¦¬í¬íŒ… ìœ„ì ¯ + AI ë¶„ì„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        inner-lens ì•„í‚¤í…ì²˜                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  [Frontend Widget]                    [Backend]                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ React/Vue/      â”‚   POST /report   â”‚ Hosted API      â”‚          â”‚
â”‚  â”‚ Vanilla Widget  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ (Vercel)        â”‚          â”‚
â”‚  â”‚                 â”‚                  â”‚ api/report.ts   â”‚          â”‚
â”‚  â”‚ - Log Capture   â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”‚ - User Actions  â”‚                           â”‚                   â”‚
â”‚  â”‚ - Navigation    â”‚        OR                 â”‚ GitHub App        â”‚
â”‚  â”‚ - Performance   â”‚                           â–¼                   â”‚
â”‚  â”‚ - Masking       â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ GitHub Issue    â”‚          â”‚
â”‚          â”‚                            â”‚ (inner-lens     â”‚          â”‚
â”‚          â”‚ Self-Hosted Mode           â”‚  label)         â”‚          â”‚
â”‚          â–¼                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚                   â”‚
â”‚  â”‚ Your Backend    â”‚                           â”‚ Triggers          â”‚
â”‚  â”‚ src/server.ts   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚ handlers        â”‚                           â–¼                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                                       â”‚ Analysis Engine â”‚          â”‚
â”‚                                       â”‚ (GitHub Actions)â”‚          â”‚
â”‚                                       â”‚ scripts/        â”‚          â”‚
â”‚                                       â”‚ analyze-issue.tsâ”‚          â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê¸°ìˆ  ìŠ¤íƒ

| ë¶„ë¥˜ | ê¸°ìˆ  |
|------|------|
| Build | tsup (ESM + CJS dual output) |
| Test | Vitest + jsdom |
| Validation | Zod |
| AI | Vercel AI SDK (Anthropic/OpenAI/Google) |
| GitHub | Octokit (REST API) |

---

## í•„ìˆ˜ ëª…ë ¹ì–´

```bash
# ê°œë°œ ì‹œ í•­ìƒ ì‹¤í–‰ (ë³€ê²½ í›„ í•„ìˆ˜)
npm run typecheck    # TypeScript íƒ€ì… ì²´í¬
npm run test         # Vitest í…ŒìŠ¤íŠ¸

# ë¹Œë“œ ê²€ì¦
npm run sync:check   # Vercel ë™ê¸°í™” ê²€ì¦ âš ï¸ ì¤‘ìš”
npm run build        # tsup ë¹Œë“œ
```

### CI íŒŒì´í”„ë¼ì¸

```bash
# PR ì œì¶œ ì „ ë°˜ë“œì‹œ í†µê³¼í•´ì•¼ í•¨
npm run typecheck && npm run sync:check && npm run test
```

---

## âš ï¸ Critical: Vercel ì œì•½

**`api/` í´ë”ëŠ” `src/`ì—ì„œ import ë¶ˆê°€!**

Vercel Serverless FunctionsëŠ” ë…ë¦½ ì‹¤í–‰ë˜ì–´ `src/` ëª¨ë“ˆì„ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ ê³µìœ  íƒ€ì…ê³¼ ìœ í‹¸ë¦¬í‹°ëŠ” **ë³µì œ**í•´ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     src/types.ts     â”‚ â”€â”€ë³µì œâ”€â–º â”‚   api/_shared.ts     â”‚
â”‚ src/utils/masking.ts â”‚ â”€â”€ë³µì œâ”€â–º â”‚   (íƒ€ì… + ë§ˆìŠ¤í‚¹)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë™ê¸°í™” ê·œì¹™

| ë³€ê²½ ëŒ€ìƒ | ë™ê¸°í™” í•„ìš” |
|-----------|-------------|
| `src/types.ts` (LogEntry, UserAction, etc.) | `api/_shared.ts` |
| `src/utils/masking.ts` (MASKING_PATTERNS) | `api/_shared.ts` |
| API í˜ì´ë¡œë“œ êµ¬ì¡° | `api/report.ts` + `src/server.ts` ë‘˜ ë‹¤ |

### ê²€ì¦ ë°©ë²•

```bash
npm run sync:check  # ìë™ ë¹„êµ ìŠ¤í¬ë¦½íŠ¸
```

ì´ ê²€ì‚¬ê°€ ì‹¤íŒ¨í•˜ë©´ CIë„ ì‹¤íŒ¨í•©ë‹ˆë‹¤.

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
inner-lens/
â”œâ”€â”€ src/                          # í´ë¼ì´ì–¸íŠ¸ SDK ì†ŒìŠ¤
â”‚   â”œâ”€â”€ types.ts                  # ê³µìœ  íƒ€ì… ì •ì˜ â­
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ InnerLensCore.ts      # í”„ë ˆì„ì›Œí¬ ë¬´ê´€ í•µì‹¬ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ InnerLensWidget.tsx   # React ìœ„ì ¯ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useInnerLens.ts       # React Hook
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ masking.ts            # ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ (27ê°œ íŒ¨í„´) â­
â”‚   â”‚   â”œâ”€â”€ log-capture.ts        # ì½˜ì†” ë¡œê·¸ ìº¡ì²˜
â”‚   â”‚   â”œâ”€â”€ user-action-capture.ts # í´ë¦­/ì…ë ¥ ìº¡ì²˜
â”‚   â”‚   â”œâ”€â”€ navigation-capture.ts  # ë¼ìš°íŒ… íˆìŠ¤í† ë¦¬ ìº¡ì²˜
â”‚   â”‚   â”œâ”€â”€ performance-capture.ts # Core Web Vitals ìº¡ì²˜
â”‚   â”‚   â”œâ”€â”€ session-replay.ts     # rrweb DOM ë¦¬í”Œë ˆì´
â”‚   â”‚   â””â”€â”€ styles.ts             # ìœ„ì ¯ ìŠ¤íƒ€ì¼ ìƒì„±
â”‚   â”œâ”€â”€ server.ts                 # Self-hosted ë°±ì—”ë“œ í•¸ë“¤ëŸ¬ â­
â”‚   â”œâ”€â”€ react.ts                  # React ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ vue.ts                    # Vue ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ vanilla.ts                # Vanilla JS ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ replay.ts                 # Session replay ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ cli.ts                    # CLI (npx inner-lens init)
â”‚   â””â”€â”€ create.ts                 # create-inner-lens ë˜í¼
â”‚
â”œâ”€â”€ api/                          # Vercel Serverless Functions
â”‚   â”œâ”€â”€ _shared.ts                # src/types + masking ë³µì œë³¸ â­
â”‚   â”œâ”€â”€ report.ts                 # POST /api/report (Hosted API)
â”‚   â””â”€â”€ health.ts                 # GET /api/health
â”‚
â”œâ”€â”€ scripts/                      # AI ë¶„ì„ ì—”ì§„
â”‚   â”œâ”€â”€ analyze-issue.ts          # ë©”ì¸ ë¶„ì„ ì§„ì…ì  â­
â”‚   â”œâ”€â”€ sync-check.ts             # Vercel ë™ê¸°í™” ê²€ì¦
â”‚   â”œâ”€â”€ agents/                   # ë¶„ì„ ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ
â”‚   â”‚   â”œâ”€â”€ orchestrator.ts       # ì—ì´ì „íŠ¸ ì¡°ìœ¨
â”‚   â”‚   â”œâ”€â”€ finder.ts             # ê´€ë ¨ íŒŒì¼ ê²€ìƒ‰
â”‚   â”‚   â”œâ”€â”€ investigator.ts       # ë²„ê·¸ ì¡°ì‚¬
â”‚   â”‚   â”œâ”€â”€ explainer.ts          # ë¶„ì„ ê²°ê³¼ ì„¤ëª…
â”‚   â”‚   â”œâ”€â”€ reviewer.ts           # ë¶„ì„ ê²€ì¦
â”‚   â”‚   â””â”€â”€ types.ts              # ì—ì´ì „íŠ¸ íƒ€ì…
â”‚   â””â”€â”€ lib/                      # ë¶„ì„ ìœ í‹¸ë¦¬í‹°
â”‚       â”œâ”€â”€ file-discovery.ts     # íŒŒì¼ ê²€ìƒ‰
â”‚       â”œâ”€â”€ code-chunking.ts      # AST-like ì½”ë“œ ì²­í‚¹
â”‚       â”œâ”€â”€ llm-rerank.ts         # LLM ê¸°ë°˜ ì¬ì •ë ¬
â”‚       â”œâ”€â”€ confidence.ts         # ì‹ ë¢°ë„ ë³´ì •
â”‚       â”œâ”€â”€ hallucination-check.ts # í™˜ê° ê²€ì¦
â”‚       â”œâ”€â”€ comment-formatter.ts  # GitHub ì½”ë©˜íŠ¸ í¬ë§·íŒ…
â”‚       â””â”€â”€ i18n.ts               # ë‹¤êµ­ì–´ ì§€ì›
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ analysis-engine.yml   # AI ë¶„ì„ ì¬ì‚¬ìš© ì›Œí¬í”Œë¡œìš°
â”‚       â””â”€â”€ test.yml              # CI í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€â”€ dist/                         # ë¹Œë“œ ì¶œë ¥ (git-ignored)
â”œâ”€â”€ examples/                     # ì˜ˆì œ ì½”ë“œ
â””â”€â”€ docs/                         # ì¶”ê°€ ë¬¸ì„œ
```

---

## í•µì‹¬ ëª¨ë“ˆ ì„¤ëª…

### 1. InnerLensCore (src/core/InnerLensCore.ts)

í”„ë ˆì„ì›Œí¬ ë¬´ê´€ í•µì‹¬ í´ë˜ìŠ¤. React/Vue/Vanilla ëª¨ë‘ ì´ê²ƒì„ ë˜í•‘.

```typescript
class InnerLensCore {
  // ìƒëª…ì£¼ê¸°
  mount()     // DOMì— ë§ˆìš´íŠ¸, ìº¡ì²˜ ì‹œì‘
  unmount()   // ì •ë¦¬
  open()      // ë‹¤ì´ì–¼ë¡œê·¸ ì—´ê¸°
  close()     // ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°
  
  // ë‚´ë¶€ ë™ì‘
  private submit()              // API í˜¸ì¶œ
  private capturePageContext()  // í˜ì´ì§€ ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘
}
```

### 2. ë§ˆìŠ¤í‚¹ ì‹œìŠ¤í…œ (src/utils/masking.ts)

22ê°œ ì •ê·œì‹ íŒ¨í„´ìœ¼ë¡œ ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹:

| íŒ¨í„´ | ì¹˜í™˜ê°’ |
|------|--------|
| ì´ë©”ì¼ | `[EMAIL_REDACTED]` |
| Bearer í† í° | `Bearer [TOKEN_REDACTED]` |
| JWT | `[JWT_REDACTED]` |
| AWS í‚¤ | `[AWS_KEY_REDACTED]` |
| GitHub í† í° | `[GITHUB_TOKEN_REDACTED]` |
| OpenAI í‚¤ | `[OPENAI_KEY_REDACTED]` |
| ì‹ ìš©ì¹´ë“œ | `[CARD_REDACTED]` |
| ì „í™”ë²ˆí˜¸ | `[PHONE_REDACTED]` |
| SSN | `[SSN_REDACTED]` |
| IP ì£¼ì†Œ | `[IP_REDACTED]` |
| Discord Webhook | `[DISCORD_WEBHOOK_REDACTED]` |
| Slack í† í° | `[SLACK_TOKEN_REDACTED]` |
| NPM í† í° | `[NPM_TOKEN_REDACTED]` |
| SendGrid í‚¤ | `[SENDGRID_KEY_REDACTED]` |
| Twilio ìê²©ì¦ëª… | `[TWILIO_REDACTED]` |

### 3. ì„œë²„ í•¸ë“¤ëŸ¬ (src/server.ts)

ë‹¤ì–‘í•œ í”„ë ˆì„ì›Œí¬ìš© í•¸ë“¤ëŸ¬ ì œê³µ:

```typescript
// Web Standards (Next.js App Router, Hono, Bun, Deno)
export function createFetchHandler(config): (req: Request) => Promise<Response>

// Express
export function createExpressHandler(config)

// Fastify
export function createFastifyHandler(config)

// Koa
export function createKoaHandler(config)

// Node.js HTTP
export function createNodeHandler(config)

// ê³µí†µ í•µì‹¬ ë¡œì§
export async function handleBugReport(body, config)
```

### 4. ë¶„ì„ ì—”ì§„ (scripts/analyze-issue.ts)

GitHub Issueë¥¼ ë¶„ì„í•˜ê³  AI ì½”ë©˜íŠ¸ë¥¼ ì‘ì„±:

```
1. Issue ë‚´ìš© íŒŒì‹±
2. ì—ëŸ¬ ìœ„ì¹˜, í‚¤ì›Œë“œ ì¶”ì¶œ
3. ê´€ë ¨ íŒŒì¼ ê²€ìƒ‰ (import graph í¬í•¨)
4. LLM ì¬ì •ë ¬
5. ì½”ë“œ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
6. AI ë¶„ì„ (Chain-of-Thought)
7. í™˜ê° ê²€ì¦ + ì‹ ë¢°ë„ ë³´ì •
8. GitHub ì½”ë©˜íŠ¸ ì‘ì„±
```

---

## ë°°í¬ ëª¨ë“œ

### Hosted Mode (ê¶Œì¥)

```typescript
// í´ë¼ì´ì–¸íŠ¸ë§Œ ì„¤ì •í•˜ë©´ ë¨
<InnerLensWidget repository="owner/repo" />
```

- GitHub App ì¸ì¦ (`inner-lens-app[bot]`)
- Rate limit: 10 req/min/IP
- í™˜ê²½ë³€ìˆ˜: `GITHUB_APP_ID`, `GITHUB_APP_PRIVATE_KEY` (Vercelì—ì„œ ê´€ë¦¬)

### Self-Hosted Mode

```typescript
// ì»¤ìŠ¤í…€ ì—”ë“œí¬ì¸íŠ¸ ì§€ì •
<InnerLensWidget 
  endpoint="/api/inner-lens/report" 
  repository="owner/repo" 
/>
```

ë°±ì—”ë“œ êµ¬í˜„ í•„ìš”:

```typescript
// app/api/inner-lens/report/route.ts (Next.js)
import { createFetchHandler } from 'inner-lens/server';

export const POST = createFetchHandler({
  githubToken: process.env.GITHUB_TOKEN!,
  repository: 'owner/repo',
});
```

- Personal Access Token ì¸ì¦
- Rate limit ì—†ìŒ
- í™˜ê²½ë³€ìˆ˜: `GITHUB_TOKEN`, `GITHUB_REPOSITORY`

---

## â›” í•„ìˆ˜ êµ¬í˜„ í”Œë¡œìš° (BLOCKING - ìˆœì„œ ìœ„ë°˜ ê¸ˆì§€)

> ëª¨ë“  ì½”ë“œ ë³€ê²½ì€ ì•„ë˜ í”Œë¡œìš°ë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.
> ê° ë‹¨ê³„ëŠ” ì´ì „ ë‹¨ê³„ ì™„ë£Œ í›„ì—ë§Œ ì§„í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### Phase 0: ìš”ì²­ ë¶„ë¥˜ (Gate Check)

| ë¶„ë¥˜ | ì‹ í˜¸ | í–‰ë™ |
|------|------|------|
| **ì‚¬ì†Œí•œ ë³€ê²½** | ë‹¨ì¼ íŒŒì¼, ëª…í™•í•œ ìœ„ì¹˜, 10ì¤„ ë¯¸ë§Œ | Phase 2ë¡œ ì§í–‰ |
| **í‘œì¤€ ë³€ê²½** | 2-5ê°œ íŒŒì¼, ëª…í™•í•œ ë²”ìœ„ | Phase 1ë¶€í„° ì‹œì‘ |
| **ëŒ€ê·œëª¨ ë³€ê²½** | 6ê°œ+ íŒŒì¼, ì•„í‚¤í…ì²˜ ì˜í–¥ | Phase 1 + Oracle ìƒë‹´ |
| **ëª¨í˜¸í•œ ìš”ì²­** | ë²”ìœ„ ë¶ˆëª…í™•, í•´ì„ ì—¬ì§€ | ë¨¼ì € ì§ˆë¬¸í•˜ê³  ëª…í™•í™” |

---

### Phase 1: ë¶„ì„ (BLOCKING - êµ¬í˜„ ì „ í•„ìˆ˜)

#### 1.1 ì½”ë“œë² ì´ìŠ¤ ë¶„ì„

```bash
# ì‹¤í–‰í•  ëª…ë ¹ì–´ë“¤
grep -rn "ê´€ë ¨í‚¤ì›Œë“œ" --include="*.ts" | head -20
```

**í™•ì¸ í•­ëª©:**
- [ ] ê´€ë ¨ íŒŒì¼ ëª¨ë‘ ì½ê¸°
- [ ] íƒ€ì… ì •ì˜ í™•ì¸ (`src/types.ts`)
- [ ] í˜¸ì¶œ ì²´ì¸ í™•ì¸ (grep)
- [ ] ê¸°ì¡´ êµ¬í˜„ ë°©ì‹/íŒ¨í„´ íŒŒì•…

#### 1.2 ì˜í–¥ ë¶„ì„ (ì‚¬ìš©ìì—ê²Œ ë°˜ë“œì‹œ ë³´ì—¬ì£¼ê¸°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ì˜í–¥ ë¶„ì„ ë¦¬í¬íŠ¸]                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ ìˆ˜ì •í•  íŒŒì¼:                                                  â”‚
â”‚    - [íŒŒì¼ ê²½ë¡œ 1]                                               â”‚
â”‚    - [íŒŒì¼ ê²½ë¡œ 2]                                               â”‚
â”‚                                                                  â”‚
â”‚ ğŸ”§ ìˆ˜ì •í•  í•¨ìˆ˜/ì»´í¬ë„ŒíŠ¸:                                         â”‚
â”‚    - [í•¨ìˆ˜ëª… 1] (íŒŒì¼:ë¼ì¸)                                      â”‚
â”‚    - [í•¨ìˆ˜ëª… 2] (íŒŒì¼:ë¼ì¸)                                      â”‚
â”‚                                                                  â”‚
â”‚ ğŸ“ í˜¸ì¶œ ì²´ì¸ (grep ê²°ê³¼):                                        â”‚
â”‚    - ì§„ì…ì  â†’ ì¤‘ê°„ â†’ ìˆ˜ì • ëŒ€ìƒ                                   â”‚
â”‚                                                                  â”‚
â”‚ âš ï¸ ì œê±°/ìš°íšŒë˜ëŠ” ê¸°ì¡´ ë¡œì§:                                      â”‚
â”‚    - [ìˆìŒ/ì—†ìŒ]                                                 â”‚
â”‚    - ì œê±° ì‹œ: ì˜ë„ì  ì œê±° / ëŒ€ì²´ êµ¬í˜„ í•„ìš”                        â”‚
â”‚                                                                  â”‚
â”‚ ğŸ”„ inner-lens ë™ê¸°í™” í•„ìš” ì—¬ë¶€:                                  â”‚
â”‚    - src/types.ts ë³€ê²½? â†’ api/_shared.ts ë™ê¸°í™”                  â”‚
â”‚    - src/utils/masking.ts ë³€ê²½? â†’ api/_shared.ts ë™ê¸°í™”          â”‚
â”‚    - API í˜ì´ë¡œë“œ ë³€ê²½? â†’ api/report.ts + src/server.ts ë‘˜ ë‹¤    â”‚
â”‚                                                                  â”‚
â”‚ ğŸ§ª í•„ìš”í•œ í…ŒìŠ¤íŠ¸:                                                â”‚
â”‚    - [í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 1]                                           â”‚
â”‚    - [í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 2]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.3 íƒ€ë‹¹ì„± ê²€ì¦ ì§ˆë¬¸

- [ ] ì œì•ˆí•œ ë°©ì‹ì´ ê¸°ì¡´ íƒ€ì…ê³¼ í˜¸í™˜ë˜ëŠ”ê°€?
- [ ] ì œì•ˆí•œ ë°©ì‹ì´ ê¸°ì¡´ í˜¸ì¶œ ì²´ì¸ì— í†µí•© ê°€ëŠ¥í•œê°€?
- [ ] ìˆ¨ê²¨ì§„ ì˜ì¡´ì„±ì´ë‚˜ ë¶€ì‘ìš©ì€ ì—†ëŠ”ê°€?
- [ ] ë” ê°„ë‹¨í•œ ë°©ë²•ì€ ì—†ëŠ”ê°€?

#### 1.4 ìŠ¹ì¸ ëŒ€ê¸° (BLOCKING)

```
â¸ï¸ ìœ„ ë¶„ì„ì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ê³  ìŠ¹ì¸ë°›ê¸° ì „ê¹Œì§€ ì½”ë“œ ìˆ˜ì • ê¸ˆì§€
```

---

### Phase 2: êµ¬í˜„

#### 2.1 êµ¬í˜„ ê·œì¹™

| ê·œì¹™ | ì„¤ëª… |
|------|------|
| ê¸°ì¡´ íŒ¨í„´ ì¤€ìˆ˜ | ì½”ë“œë² ì´ìŠ¤ì˜ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ë”°ë¥´ê¸° |
| ìµœì†Œ ë³€ê²½ ì›ì¹™ | ë²„ê·¸ ìˆ˜ì • ì‹œ ë¦¬íŒ©í† ë§ ê¸ˆì§€ |
| íƒ€ì… ì•ˆì „ì„± | `any`, `@ts-ignore` ì‚¬ìš© ê¸ˆì§€ |
| ì ì§„ì  êµ¬í˜„ | ì‘ì€ ë‹¨ìœ„ë¡œ ë³€ê²½í•˜ë©° ê²€ì¦ |

#### 2.2 inner-lens íŠ¹í™” ê·œì¹™

| ë³€ê²½ ëŒ€ìƒ | í•„ìˆ˜ ë™ê¸°í™” |
|-----------|-------------|
| `src/types.ts` | `api/_shared.ts` |
| `src/utils/masking.ts` | `api/_shared.ts` |
| API í˜ì´ë¡œë“œ êµ¬ì¡° | `api/report.ts` + `src/server.ts` |
| ì‚¬ìš©ì ëŒ€ë©´ í…ìŠ¤íŠ¸ | ì˜ì–´ë¡œ ì‘ì„± (ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤) |
| UI í…ìŠ¤íŠ¸ ì¶”ê°€ | `WIDGET_TEXTS` 5ê°œ ì–¸ì–´ ëª¨ë‘ |

---

### Phase 3: ê²€ì¦ (BLOCKING - ëª¨ë‘ í†µê³¼ í•„ìˆ˜)

#### 3.1 í•„ìˆ˜ ê²€ì¦ ëª…ë ¹ì–´ (ìˆœì„œ ì—„ìˆ˜)

```bash
# 1ï¸âƒ£ íƒ€ì… ì²´í¬ (í•„ìˆ˜)
npm run typecheck

# 2ï¸âƒ£ Vercel ë™ê¸°í™” ê²€ì¦ (inner-lens íŠ¹í™”)
npm run sync:check

# 3ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test

# 4ï¸âƒ£ ë¹Œë“œ ê²€ì¦ (ìµœì¢…)
npm run build
```

#### 3.2 í˜¸ì¶œ ê²½ë¡œ ì¦ëª… (BLOCKING)

```bash
# ìƒˆë¡œ ë§Œë“ /ìˆ˜ì •í•œ í•¨ìˆ˜ê°€ ì‹¤ì œë¡œ í˜¸ì¶œë˜ëŠ”ì§€ ì¦ëª…
grep -rn "í•¨ìˆ˜ëª…(" --include="*.ts" | grep -v test | grep -v "\.d\.ts"
```

**ì¦ëª… ìš”êµ¬ì‚¬í•­:**
- í˜¸ì¶œ íšŸìˆ˜ 0ì´ë©´ â†’ "ì™„ë£Œ" ì•„ë‹˜
- í˜¸ì¶œ ê²½ë¡œë¥¼ ì§„ì…ì ë¶€í„° ë‚˜ì—´í•´ì„œ ë³´ì—¬ì£¼ê¸°

```
í˜¸ì¶œ ê²½ë¡œ ì˜ˆì‹œ:
main.ts (ì§„ì…ì )
  â†’ router.ts (L45)
    â†’ handler.ts (L120)
      â†’ ìƒˆí•¨ìˆ˜() âœ“
```

#### 3.3 LSP ì§„ë‹¨ í™•ì¸

```bash
# ë³€ê²½ëœ íŒŒì¼ë“¤ì— ëŒ€í•´ LSP ì§„ë‹¨ ì‹¤í–‰
lsp_diagnostics("ìˆ˜ì •í•œíŒŒì¼.ts")
```

- ì—ëŸ¬: 0ê°œ (í•„ìˆ˜)
- ê²½ê³ : ê²€í†  í›„ ë¬´ì‹œ ê°€ëŠ¥í•œ ê²ƒë§Œ í—ˆìš©

---

### Phase 4: ì™„ë£Œ ì¡°ê±´ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëª¨ë‘ âœ“ í•„ìˆ˜)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ì™„ë£Œ ì¡°ê±´ ì²´í¬ë¦¬ìŠ¤íŠ¸]                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 1 (ë¶„ì„)                                                   â”‚
â”‚ - [ ] ì˜í–¥ ë¶„ì„ ì™„ë£Œ                                             â”‚
â”‚ - [ ] ì‚¬ìš©ì ìŠ¹ì¸ íšë“                                           â”‚
â”‚                                                                  â”‚
â”‚ Phase 2 (êµ¬í˜„)                                                   â”‚
â”‚ - [ ] ê¸°ì¡´ íŒ¨í„´ ì¤€ìˆ˜                                             â”‚
â”‚ - [ ] inner-lens ë™ê¸°í™” ì™„ë£Œ (í•´ë‹¹ ì‹œ)                           â”‚
â”‚                                                                  â”‚
â”‚ Phase 3 (ê²€ì¦)                                                   â”‚
â”‚ - [ ] npm run typecheck í†µê³¼                                     â”‚
â”‚ - [ ] npm run sync:check í†µê³¼                                    â”‚
â”‚ - [ ] npm run test í†µê³¼                                          â”‚
â”‚ - [ ] ìƒˆ í•¨ìˆ˜ í˜¸ì¶œ ê²½ë¡œ grepìœ¼ë¡œ ì¦ëª…                            â”‚
â”‚ - [ ] LSP ì§„ë‹¨ ì—ëŸ¬ 0ê°œ                                          â”‚
â”‚                                                                  â”‚
â”‚ Phase 4 (ìµœì¢…)                                                   â”‚
â”‚ - [ ] ê¸°ì¡´ ê¸°ëŠ¥ ì •ìƒ ì‘ë™ í™•ì¸                                   â”‚
â”‚ - [ ] í…ŒìŠ¤íŠ¸ ì¶”ê°€ (ìƒˆ ê¸°ëŠ¥ ì‹œ)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**â›” "í…ŒìŠ¤íŠ¸ í†µê³¼í–ˆìŠµë‹ˆë‹¤"ë§Œìœ¼ë¡œ ì™„ë£Œ ì„ ì–¸ ê¸ˆì§€**

---

### Phase 5: ì‹¤íŒ¨ ë³µêµ¬ í”„ë¡œì„¸ìŠ¤

#### 5.1 ê²€ì¦ ì‹¤íŒ¨ ì‹œ

| ì‹¤íŒ¨ ìœ í˜• | ë³µêµ¬ í–‰ë™ |
|-----------|----------|
| typecheck ì‹¤íŒ¨ | íƒ€ì… ì—ëŸ¬ ìˆ˜ì • â†’ ì¬ê²€ì¦ |
| sync:check ì‹¤íŒ¨ | ë™ê¸°í™” ëˆ„ë½ íŒŒì¼ ìˆ˜ì • â†’ ì¬ê²€ì¦ |
| test ì‹¤íŒ¨ | ì›ì¸ ë¶„ì„ â†’ êµ¬í˜„ ìˆ˜ì • â†’ ì¬ê²€ì¦ |

#### 5.2 3íšŒ ì—°ì† ì‹¤íŒ¨ ì‹œ (BLOCKING)

```
â›” ì¦‰ì‹œ ì¤‘ë‹¨
1. ëª¨ë“  ë³€ê²½ì‚¬í•­ ë˜ëŒë¦¬ê¸°: git checkout -- .
2. ì‹¤íŒ¨ ì›ì¸ ë¬¸ì„œí™”
3. Oracle ì—ì´ì „íŠ¸ì— ìƒë‹´ ìš”ì²­
4. ì‚¬ìš©ìì—ê²Œ ìƒí™© ë³´ê³  í›„ ì§€ì‹œ ëŒ€ê¸°
```

#### 5.3 ë¡¤ë°± ê³„íš

```bash
# ì‘ì—… ì‹œì‘ ì „ ë¸Œëœì¹˜ ìƒì„± (ê¶Œì¥)
git checkout -b feature/ì‘ì—…ë‚´ìš©

# ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
git checkout main  # ë˜ëŠ” ì›ë˜ ë¸Œëœì¹˜
git branch -D feature/ì‘ì—…ë‚´ìš©  # ì‹¤íŒ¨í•œ ë¸Œëœì¹˜ ì‚­ì œ
```

---

### ì—ì´ì „íŠ¸ ìë™ íŠ¸ë¦¬ê±° (ì°¸ê³ )

| ìƒí™© | ìë™ ì‹¤í–‰ ì—ì´ì „íŠ¸ |
|------|-------------------|
| ì½”ë“œ ë³€ê²½ ì™„ë£Œ | `code-reviewer` |
| íƒ€ì… ë³€ê²½ | `type-sync-checker` |
| api/ íŒŒì¼ ë³€ê²½ | `vercel-constraint-checker` |
| masking.ts ë³€ê²½ | `security-validator` |
| í…ŒìŠ¤íŠ¸ ì‘ì„± ì™„ë£Œ | `test-quality-validator` |
| êµ¬í˜„ ì™„ë£Œ | `docs-sync` |

---

### ë¹ ë¥¸ ì°¸ì¡°: ëª…ë ¹ì–´ ì²´ì¸

```bash
# PR ì œì¶œ ì „ ë°˜ë“œì‹œ ì‹¤í–‰ (ìˆœì„œ ì—„ìˆ˜)
npm run typecheck && npm run sync:check && npm run test && npm run build
```

---

## ì½”ë“œ ê·œì¹™

### âœ… í•„ìˆ˜

1. **ë³€ê²½ ì „ ê´€ë ¨ íŒŒì¼ ì½ê¸°**
   - ê¸°ì¡´ íŒ¨í„´/êµ¬ì¡° íŒŒì•…

2. **ë³€ê²½ í›„ ê²€ì¦**
   ```bash
   npm run typecheck && npm run test
   ```

3. **Vercel ì œì•½ ì¤€ìˆ˜**
   - `src/types.ts` ë³€ê²½ ì‹œ â†’ `api/_shared.ts` ë™ê¸°í™”
   - `src/utils/masking.ts` ë³€ê²½ ì‹œ â†’ `api/_shared.ts` ë™ê¸°í™”
   - `npm run sync:check` ì‹¤í–‰

4. **í…ŒìŠ¤íŠ¸ ì‘ì„±**
   - ìƒˆ ê¸°ëŠ¥: í…ŒìŠ¤íŠ¸ í•„ìˆ˜
   - ë²„ê·¸ ìˆ˜ì •: íšŒê·€ í…ŒìŠ¤íŠ¸ ì¶”ê°€

### âŒ ê¸ˆì§€

| í•­ëª© | ì´ìœ  |
|------|------|
| `any` íƒ€ì… | íƒ€ì… ì•ˆì „ì„± ìœ„ë°˜ |
| `@ts-ignore` / `@ts-expect-error` | ì—ëŸ¬ ë¬´ì‹œ ê¸ˆì§€ |
| ìš”ì²­í•˜ì§€ ì•Šì€ ë¦¬íŒ©í† ë§ | ìŠ¤ì½”í”„ ìœ ì§€ |
| `console.log` ë‚¨ê¸°ê¸° | í”„ë¡œë•ì…˜ ì½”ë“œ ì˜¤ì—¼ |
| TODO/FIXME ì£¼ì„ | ì´ìŠˆ íŠ¸ë˜ì»¤ ì‚¬ìš© |
| ì§ì ‘ `fetch` ëŒ€ì‹  í•¸ë“¤ëŸ¬ ìš°íšŒ | ë³´ì•ˆ/ì¼ê´€ì„± ìœ„ë°˜ |

---

## í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### íŒŒì¼ ìœ„ì¹˜

```
src/utils/masking.ts       â†’ src/utils/masking.test.ts
src/server.ts              â†’ src/server.test.ts
scripts/sync-check.ts      â†’ scripts/sync-check.test.ts
```

### ì‹¤í–‰

```bash
npm run test                    # ì „ì²´ í…ŒìŠ¤íŠ¸
npm run test -- --watch         # Watch ëª¨ë“œ
npm run test -- masking         # íŠ¹ì • íŒŒì¼
npm run test:coverage           # ì»¤ë²„ë¦¬ì§€
```

### íŒ¨í„´

```typescript
import { describe, it, expect, vi } from 'vitest';
import { maskSensitiveData } from './masking';

describe('maskSensitiveData', () => {
  it('should mask email addresses', () => {
    expect(maskSensitiveData('user@example.com'))
      .toBe('[EMAIL_REDACTED]');
  });
  
  it('should handle empty input', () => {
    expect(maskSensitiveData('')).toBe('');
  });
});
```

---

## npm exports

```typescript
// í´ë¼ì´ì–¸íŠ¸
import { InnerLensWidget, useInnerLens } from 'inner-lens/react';
import { InnerLensWidget } from 'inner-lens/vue';
import { InnerLens } from 'inner-lens/vanilla';

// ì„œë²„
import { 
  createFetchHandler,
  createExpressHandler,
  createFastifyHandler,
  createKoaHandler,
  createNodeHandler,
  handleBugReport,
  maskSensitiveData,
} from 'inner-lens/server';
```

---

## ì¡°ê±´ë¶€ ê·œì¹™ (.claude/rules/)

íŠ¹ì • íŒŒì¼ íŒ¨í„´ì— ë”°ë¼ ìë™ ë¡œë“œ:

| íŒŒì¼ | ì ìš© ëŒ€ìƒ | ë‚´ìš© |
|------|----------|------|
| `typescript.md` | ëª¨ë“  `.ts` | strict íƒ€ì…, ì½”ë”© ìŠ¤íƒ€ì¼ |
| `testing.md` | `*.test.ts` | Vitest íŒ¨í„´, ëª¨í‚¹ |
| `security.md` | masking, server, api | ë§ˆìŠ¤í‚¹ í•„ìˆ˜, ì‹œí¬ë¦¿ ê´€ë¦¬ |
| `react.md` | components, hooks | React íŒ¨í„´ |
| `api.md` | api/, server.ts | Zod ê²€ì¦, ì—ëŸ¬ ì‘ë‹µ |

---

## ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

### Q: `api/_shared.ts`ë¥¼ ì™œ ë¶„ë¦¬í–ˆë‚˜ìš”?

Vercel Serverless FunctionsëŠ” ë°°í¬ ì‹œ ê° í•¨ìˆ˜ê°€ ë…ë¦½ì ìœ¼ë¡œ ë²ˆë“¤ë©ë‹ˆë‹¤.
`src/` í´ë”ë¥¼ ì°¸ì¡°í•  ìˆ˜ ì—†ì–´ì„œ í•„ìš”í•œ íƒ€ì…ê³¼ ìœ í‹¸ë¦¬í‹°ë¥¼ ë³µì œí•©ë‹ˆë‹¤.

### Q: ë§ˆìŠ¤í‚¹ íŒ¨í„´ì„ ì¶”ê°€í•˜ë ¤ë©´?

1. `src/utils/masking.ts`ì˜ `MASKING_PATTERNS` ë°°ì—´ì— ì¶”ê°€
2. `api/_shared.ts`ì—ë„ ë™ì¼í•˜ê²Œ ì¶”ê°€
3. `npm run sync:check`ë¡œ ë™ê¸°í™” í™•ì¸
4. `src/utils/masking.test.ts`ì— í…ŒìŠ¤íŠ¸ ì¶”ê°€

### Q: ìƒˆ í”„ë ˆì„ì›Œí¬ í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€í•˜ë ¤ë©´?

1. `src/server.ts`ì— `createXxxHandler` í•¨ìˆ˜ ì¶”ê°€
2. `handleBugReport` í˜¸ì¶œí•˜ëŠ” ì–´ëŒ‘í„° íŒ¨í„´ ì‚¬ìš©
3. README.mdì— ì˜ˆì œ ì¶”ê°€

### Q: AI ë¶„ì„ ì–¸ì–´ë¥¼ ì¶”ê°€í•˜ë ¤ë©´?

1. `scripts/lib/i18n.ts`ì— ì–¸ì–´ ì¶”ê°€
2. `src/types.ts`ì˜ `WidgetLanguage` íƒ€ì… í™•ì¥
3. `WIDGET_TEXTS` ê°ì²´ì— ë²ˆì—­ ì¶”ê°€

---

## ë²„ì „ ê´€ë¦¬

- `v1` íƒœê·¸: ì•ˆì • ë²„ì „ (ë¶„ì„ ì—”ì§„ ì›Œí¬í”Œë¡œìš°ì—ì„œ ì°¸ì¡°)
- `main` ë¸Œëœì¹˜: ê°œë°œ ë²„ì „

```bash
# v1 íƒœê·¸ ì—…ë°ì´íŠ¸ (main ë³€ê²½ í›„)
git tag -f v1
git push origin v1 --force
```

---

## ë¬¸ì˜

- **ì´ìŠˆ**: [GitHub Issues](https://github.com/jhlee0409/inner-lens/issues)
- **ê¸°ì—¬ ê°€ì´ë“œ**: [CONTRIBUTING.md](./CONTRIBUTING.md)
