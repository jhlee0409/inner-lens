# inner-lens AI Analysis - 사용자 템플릿과 동일한 형태로 테스트
#
# README.md의 템플릿과 동일하게 외부 참조 사용:
#   uses: jhlee0409/inner-lens/.github/workflows/analysis-engine.yml@v1
#
# workflow_dispatch는 수동 테스트용으로 추가

name: Analyze Issues

on:
  issues:
    types: [opened]

  workflow_dispatch:
    inputs:
      issue_number:
        description: 'Issue number to analyze'
        required: true
        type: number

# Prevent duplicate runs for the same issue
concurrency:
  group: analyze-issue-${{ github.event.issue.number || inputs.issue_number }}
  cancel-in-progress: true

permissions:
  contents: read
  issues: write

jobs:
  # README 템플릿과 동일한 구조
  analyze:
    # issues 이벤트: inner-lens 라벨 체크
    # workflow_dispatch: 항상 실행
    if: |
      github.event_name == 'workflow_dispatch' || 
      contains(github.event.issue.labels.*.name, 'inner-lens')
    uses: jhlee0409/inner-lens/.github/workflows/analysis-engine.yml@v1
    with:
      issue_number: ${{ github.event.issue.number || inputs.issue_number }}
      provider: 'google'
      model: 'gemini-2.5-flash'
      language: 'ko'
    secrets:
      GOOGLE_GENERATIVE_AI_API_KEY: ${{ secrets.GOOGLE_GENERATIVE_AI_API_KEY }}
